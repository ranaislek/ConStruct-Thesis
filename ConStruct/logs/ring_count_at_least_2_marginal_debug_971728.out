torch version: 2.0.1+cu118
CUDA available: True
CUDA device: NVIDIA RTX 2000 Ada Generation
=== Running Quick Test: ring_count_at_least_2_marginal_debug ===
Config: debug/edge_insertion/ring_count_at_least/qm9_debug_ring_count_at_least_2_marginal_test
Purpose: Quick test with marginal transition (5 epochs, small batch size)
Constraint: ring_count_at_least >= 2 (minimum 2 rings required)
Transition: marginal (natural edge distribution)
Job ID: 971728
Node: debug01
Time: Mon 21 Jul 2025 04:57:42 PM UTC
<frozen importlib._bootstrap>:228: RuntimeWarning: to-Python converter for std::pair<double, double> already registered; second conversion method ignored.
[rank: 0] Global seed set to 42
Loading reference metrics.
Marginal distribution of the classes: nodes: tensor([0.7231, 0.1151, 0.1591, 0.0026]) -- edges: tensor([0.7261, 0.2383, 0.0274, 0.0082, 0.0000]) --charges: tensor([0.0078, 0.9705, 0.0218])
‚úì Validated: Marginal transition 'marginal' with 'ring_count_at_least' projector
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
[2025-07-21 16:57:47,855][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2025-07-21 16:57:47,855][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA RTX 2000 Ada Generation') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 1.5 K 
----------------------------------------------------------------
1.5 K     Trainable params
0         Non-trainable params
1.5 K     Total params
0.006     Total estimated model params size (MB)
wandb: Currently logged in as: islekrana (islekrana-universit-di-padova). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.21.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /extra/rislek/ConStruct-Thesis/ConStruct/wandb/run-20250721_165749-x0eogljd
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run qm9_debug_ring_count_at_least_2_marginal_test
wandb: ‚≠êÔ∏è View project at https://wandb.ai/islekrana-universit-di-padova/ConStruct_qm9
wandb: üöÄ View run at https://wandb.ai/islekrana-universit-di-padova/ConStruct_qm9/runs/x0eogljd
SLURM auto-requeueing enabled. Setting signal handlers.
Epoch 0: val/epoch_NLL: 54.27 -- val/X_kl: 4.38 -- val/E_kl: 36.78 -- val/charges_kl: 5.51 
Val loss: 54.2693 	 Best val loss:  54.2693

Val epoch 0 ends
Starting epoch 0
[2025-07-21 16:57:53,615][torch.nn.parallel.distributed][INFO] - Reducer buckets have been rebuilt in this iteration.
Train epoch 0 ends
Epoch 0 finished: X: 0.64 -- charges: 0.12 -- E: 0.60 -- y: -1.00 -- 179.4s 
Epoch 0: {'CarbonCE': 0.48, 'NitroCE': 0.279, 'OxyCE': 0.355, 'FluorCE': 0.031} -- {'NoBondCE': 0.491, 'SingleCE': 0.452, 'DoubleCE': 0.1, 'TripleCE': 0.043, 'AromaticCE': 0.015}
Starting epoch 1
Epoch 1: val/epoch_NLL: 35.15 -- val/X_kl: 3.98 -- val/E_kl: 29.93 -- val/charges_kl: 0.69 
Val loss: 35.1536 	 Best val loss:  35.1536

Sampling start
Sampling a batch with 5 graphs on local rank 0. Saving 5 visualization and 2 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Batch sampled. Visualizing chains starts!
1/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch1/batch5_GR0/molecule_5_0.gif to wandb
2/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch1/batch5_GR0/molecule_6_0.gif to wandb
Visualizing 5 graphs out of 5
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch1_b5/graph_0.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch1_b5/graph_1.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch1_b5/graph_2.png to wandb
Done.
Sampling a batch with 5 graphs on local rank 0. Saving 0 visualization and 0 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Done.
Sampled 2 batches on local rank 0. Sampling took 3.72 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 4, Kekulize 0, other 2,  -- No error 4
Some generated smiles: CC(O)OC1(C)CC1 ON1CNNC1[OH2+] error error C[NH2+]OC(C)[NH3+] OC1=[O+]NC2OC2C1 error error error error
DEBUG: Calling check_ring_constraints with 10 smiles, type=ring_count_at_least, value=2
DEBUG: Constraint detected! Type: ring_count_at_least, Value: 2
DEBUG: check_ring_constraints called with 10 smiles, type=ring_count_at_least, value=2
[Constraint Check] 1/4 molecules satisfy ring_count_at_least ‚â• 2
FCD score: 17.545984916042492
Molecular metrics computed.
Sampling metrics {'val_sampling/NumNodesW1': 0.168, 'val_sampling/NodeTypesTV': 0.111, 'val_sampling/EdgeTypesTV': 0.153, 'val_sampling/Disconnected': 70.0, 'val_sampling/MeanComponents': 1.9, 'val_sampling/MaxComponents': 3.0, 'val_sampling/planarity': 1.0, 'val_sampling/no_cycles': 0.4, 'val_sampling/lobster_components': 0.4, 'val_sampling/generated_deg_hist': [0.103, 0.287, 0.402, 0.149, 0.034, 0.023, 0.0, 0.0, 0.0], 'val_sampling/diff_deg_hist': [0.103, 0.047, -0.03, -0.123, -0.02, 0.022, 0.0, 0.0, 0.0], 'val_sampling/abs_diff_deg_hist': [0.103, 0.047, 0.03, 0.123, 0.02, 0.022, 0.0, 0.0, 0.0], 'val_sampling/Validity': 40.0, 'val_sampling/Uniqueness': 100.0, 'val_sampling/Novelty': 100.0, 'val_sampling/fcd score': 17.546, 'val_sampling/ChargeW1': 0.031, 'val_sampling/ValencyW1': 0.712, 'val_ratio/fcd score': 20.334, 'val_ratio/average': 20.334}
Val epoch 1 ends
Train epoch 1 ends
Epoch 1 finished: X: 0.60 -- charges: 0.10 -- E: 0.56 -- y: -1.00 -- 204.6s 
Epoch 1: {'CarbonCE': 0.466, 'NitroCE': 0.268, 'OxyCE': 0.34, 'FluorCE': 0.014} -- {'NoBondCE': 0.474, 'SingleCE': 0.445, 'DoubleCE': 0.092, 'TripleCE': 0.034, 'AromaticCE': 0.002}
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: X: 0.57 -- charges: 0.10 -- E: 0.56 -- y: -1.00 -- 173.6s 
Epoch 2: {'CarbonCE': 0.444, 'NitroCE': 0.252, 'OxyCE': 0.325, 'FluorCE': 0.012} -- {'NoBondCE': 0.473, 'SingleCE': 0.445, 'DoubleCE': 0.089, 'TripleCE': 0.033, 'AromaticCE': 0.001}
Starting epoch 3
Epoch 3: val/epoch_NLL: 34.83 -- val/X_kl: 3.74 -- val/E_kl: 29.88 -- val/charges_kl: 0.65 
Val loss: 34.8260 	 Best val loss:  34.8260

Sampling start
Sampling a batch with 5 graphs on local rank 0. Saving 5 visualization and 2 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Batch sampled. Visualizing chains starts!
1/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch3/batch5_GR0/molecule_5_0.gif to wandb
2/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch3/batch5_GR0/molecule_6_0.gif to wandb
Visualizing 5 graphs out of 5
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch3_b5/graph_0.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch3_b5/graph_1.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2_marginal_test/epoch3_b5/graph_2.png to wandb
Done.
Sampling a batch with 5 graphs on local rank 0. Saving 0 visualization and 0 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Done.
Sampled 2 batches on local rank 0. Sampling took 3.49 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 6, Kekulize 0, other 1,  -- No error 3
Some generated smiles: error error error error error error C=NCO CCNC C=CCC1(C=C)OO1 error
DEBUG: Calling check_ring_constraints with 10 smiles, type=ring_count_at_least, value=2
DEBUG: Constraint detected! Type: ring_count_at_least, Value: 2
DEBUG: check_ring_constraints called with 10 smiles, type=ring_count_at_least, value=2
[Constraint Check] 0/3 molecules satisfy ring_count_at_least ‚â• 2
[rank: 0] Received SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
Bypassing SIGTERM: 15
slurmstepd-debug01: error: *** JOB 971728 ON debug01 CANCELLED AT 2025-07-21T17:37:31 ***
[rank: 0] Received SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
Exception in thread NetStatThr:
Traceback (most recent call last):
  File "/home/rislek/.conda/envs/construct/lib/python3.9/threading.py", line 980, in _bootstrap_inner
Exception in thread ChkStopThr:
Traceback (most recent call last):
  File "/home/rislek/.conda/envs/construct/lib/python3.9/threading.py", line 980, in _bootstrap_inner
    self.run()
  File "/home/rislek/.conda/envs/construct/lib/python3.9/threading.py", line 917, in run
    self.run()    
self._target(*self._args, **self._kwargs)  File "/home/rislek/.conda/envs/construct/lib/python3.9/threading.py", line 917, in run

  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 257, in check_network_status
    self._target(*self._args, **self._kwargs)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 275, in check_stop_status
    self._loop_check_status(
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 213, in _loop_check_status
    self._loop_check_status(
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/wandb_run.py", line 213, in _loop_check_status
    local_handle = request()
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface.py", line 797, in deliver_network_status
    local_handle = request()
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface.py", line 789, in deliver_stop_status
    return self._deliver_network_status(status)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 601, in _deliver_network_status
    return self._deliver_stop_status(status)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 585, in _deliver_stop_status
    return self._deliver_record(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 560, in _deliver_record
    return self._deliver_record(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_shared.py", line 560, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    handle = mailbox._deliver_record(record, interface=self)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/mailbox.py", line 455, in _deliver_record
    interface._publish(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    interface._publish(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/interface/interface_sock.py", line 51, in _publish
    self._sock_client.send_record_publish(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self._sock_client.send_record_publish(record)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 221, in send_record_publish
    self.send_server_request(server_req)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self.send_server_request(server_req)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 155, in send_server_request
    self._send_message(msg)
      File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
self._send_message(msg)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 152, in _send_message
    self._sendall_with_error_handle(header + data)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    self._sendall_with_error_handle(header + data)
  File "/home/rislek/.conda/envs/construct/lib/python3.9/site-packages/wandb/sdk/lib/sock_client.py", line 130, in _sendall_with_error_handle
    sent = self._sock.send(data)
BrokenPipeError    : sent = self._sock.send(data)[Errno 32] Broken pipe

BrokenPipeError: [Errno 32] Broken pipe
