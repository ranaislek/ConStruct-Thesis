torch version: 2.0.1+cu118
CUDA available: True
CUDA device: NVIDIA RTX 2000 Ada Generation
=== Running Edge-Insertion Ring Count At Least 2 Experiment ===
Config: 300 epochs, batch_size=128, 500 samples, edge-insertion transition
Purpose: Generate molecules with AT LEAST 2 rings using edge-insertion mechanism
Constraint: ring_count_at_least >= 2 (minimum 2 rings required)
Transition: edge_insertion (adds edges to satisfy minimum ring constraints)
Job ID: 971727
Node: debug04
Time: Mon 21 Jul 2025 04:57:36 PM UTC
<frozen importlib._bootstrap>:228: RuntimeWarning: to-Python converter for std::pair<double, double> already registered; second conversion method ignored.
[rank: 0] Global seed set to 42
Loading reference metrics.
Edge-insertion transition model (for 'at least' constraints)
‚úì Validated: Edge-insertion transition 'edge_insertion' with 'ring_count_at_least' projector
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
[rank: 0] Global seed set to 42
Initializing distributed: GLOBAL_RANK: 0, MEMBER: 1/1
[2025-07-21 16:57:41,445][torch.distributed.distributed_c10d][INFO] - Added key: store_based_barrier_key:1 to store for rank: 0
[2025-07-21 16:57:41,445][torch.distributed.distributed_c10d][INFO] - Rank 0: Completed store-based barrier for key:store_based_barrier_key:1 with 1 nodes.
----------------------------------------------------------------------------------------------------
distributed_backend=nccl
All distributed processes registered. Starting with 1 processes
----------------------------------------------------------------------------------------------------

You are using a CUDA device ('NVIDIA RTX 2000 Ada Generation') that has Tensor Cores. To properly utilize them, you should set `torch.set_float32_matmul_precision('medium' | 'high')` which will trade-off precision for performance. For more details, read https://pytorch.org/docs/stable/generated/torch.set_float32_matmul_precision.html#torch.set_float32_matmul_precision
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name                  | Type                  | Params
----------------------------------------------------------------
0 | train_loss            | TrainLoss             | 0     
1 | train_metrics         | TrainMolecularMetrics | 0     
2 | val_metrics           | MetricCollection      | 0     
3 | val_nll               | NLL                   | 0     
4 | val_sampling_metrics  | SamplingMetrics       | 0     
5 | test_metrics          | MetricCollection      | 0     
6 | test_nll              | NLL                   | 0     
7 | test_sampling_metrics | SamplingMetrics       | 0     
8 | model                 | GraphTransformer      | 1.5 K 
----------------------------------------------------------------
1.5 K     Trainable params
0         Non-trainable params
1.5 K     Total params
0.006     Total estimated model params size (MB)
wandb: Currently logged in as: islekrana (islekrana-universit-di-padova). Use `wandb login --relogin` to force relogin
wandb: wandb version 0.21.0 is available!  To upgrade, please run:
wandb:  $ pip install wandb --upgrade
wandb: Tracking run with wandb version 0.15.4
wandb: Run data is saved locally in /extra/rislek/ConStruct-Thesis/ConStruct/wandb/run-20250721_165742-lk2h0tm4
wandb: Run `wandb offline` to turn off syncing.
wandb: Syncing run qm9_debug_ring_count_at_least_2
wandb: ‚≠êÔ∏è View project at https://wandb.ai/islekrana-universit-di-padova/ConStruct_qm9
wandb: üöÄ View run at https://wandb.ai/islekrana-universit-di-padova/ConStruct_qm9/runs/lk2h0tm4
SLURM auto-requeueing enabled. Setting signal handlers.
Epoch 0: val/epoch_NLL: 208.55 -- val/X_kl: 48.81 -- val/E_kl: 13.28 -- val/charges_kl: 67.85 
Val loss: 208.5513 	 Best val loss:  208.5513

Val epoch 0 ends
Starting epoch 0
[2025-07-21 16:57:47,163][torch.nn.parallel.distributed][INFO] - Reducer buckets have been rebuilt in this iteration.
Train epoch 0 ends
Epoch 0 finished: X: 0.61 -- charges: 0.13 -- E: 0.40 -- y: -1.00 -- 181.7s 
Epoch 0: {'CarbonCE': 0.459, 'NitroCE': 0.269, 'OxyCE': 0.334, 'FluorCE': 0.026} -- {'NoBondCE': 0.34, 'SingleCE': 0.238, 'DoubleCE': 0.095, 'TripleCE': 0.048, 'AromaticCE': 0.02}
Starting epoch 1
Epoch 1: val/epoch_NLL: 219.20 -- val/X_kl: 11.04 -- val/E_kl: 43.38 -- val/charges_kl: 1.86 
Val loss: 219.1966 	 Best val loss:  208.5513

Sampling start
Sampling a batch with 5 graphs on local rank 0. Saving 5 visualization and 2 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Batch sampled. Visualizing chains starts!
1/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch1/batch5_GR0/molecule_5_0.gif to wandb
2/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch1/batch5_GR0/molecule_6_0.gif to wandb
Visualizing 5 graphs out of 5
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch1_b5/graph_0.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch1_b5/graph_1.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch1_b5/graph_2.png to wandb
Done.
Sampling a batch with 5 graphs on local rank 0. Saving 0 visualization and 0 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Done.
Sampled 2 batches on local rank 0. Sampling took 15.90 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 4, Kekulize 0, other 0,  -- No error 6
Some generated smiles: error CC(O)[C+]1C(C)C1(C)[NH3+] CC12CCCC1CC2 OC12CC34[CH+]CC15C3C425 error CC1CC(N)C1C error CCCOOCC error C[NH+]1CC23CC2C1O3
DEBUG: Calling check_ring_constraints with 10 smiles, type=ring_count_at_least, value=2
DEBUG: Constraint detected! Type: ring_count_at_least, Value: 2
DEBUG: check_ring_constraints called with 10 smiles, type=ring_count_at_least, value=2
[Constraint Check] 3/6 molecules satisfy ring_count_at_least ‚â• 2
FCD score: 15.559214294302159
Molecular metrics computed.
Sampling metrics {'val_sampling/NumNodesW1': 0.168, 'val_sampling/NodeTypesTV': 0.073, 'val_sampling/EdgeTypesTV': 0.071, 'val_sampling/Disconnected': 30.0, 'val_sampling/MeanComponents': 1.4, 'val_sampling/MaxComponents': 3.0, 'val_sampling/planarity': 1.0, 'val_sampling/no_cycles': 0.1, 'val_sampling/lobster_components': 0.1, 'val_sampling/generated_deg_hist': [0.046, 0.195, 0.356, 0.287, 0.103, 0.0, 0.011, 0.0, 0.0], 'val_sampling/diff_deg_hist': [0.046, -0.045, -0.076, 0.015, 0.049, -0.001, 0.011, 0.0, 0.0], 'val_sampling/abs_diff_deg_hist': [0.046, 0.045, 0.076, 0.015, 0.049, 0.001, 0.011, 0.0, 0.0], 'val_sampling/Validity': 60.0, 'val_sampling/Uniqueness': 100.0, 'val_sampling/Novelty': 100.0, 'val_sampling/fcd score': 15.559, 'val_sampling/ChargeW1': 0.099, 'val_sampling/ValencyW1': 0.432, 'val_ratio/fcd score': 18.031, 'val_ratio/average': 18.031}
Val epoch 1 ends
Train epoch 1 ends
Epoch 1 finished: X: 0.55 -- charges: 0.09 -- E: 0.29 -- y: -1.00 -- 222.0s 
Epoch 1: {'CarbonCE': 0.422, 'NitroCE': 0.246, 'OxyCE': 0.306, 'FluorCE': 0.013} -- {'NoBondCE': 0.276, 'SingleCE': 0.186, 'DoubleCE': 0.066, 'TripleCE': 0.034, 'AromaticCE': 0.001}
Starting epoch 2
Train epoch 2 ends
Epoch 2 finished: X: 0.54 -- charges: 0.09 -- E: 0.27 -- y: -1.00 -- 176.8s 
Epoch 2: {'CarbonCE': 0.414, 'NitroCE': 0.241, 'OxyCE': 0.3, 'FluorCE': 0.013} -- {'NoBondCE': 0.267, 'SingleCE': 0.184, 'DoubleCE': 0.06, 'TripleCE': 0.029, 'AromaticCE': 0.001}
Starting epoch 3
Epoch 3: val/epoch_NLL: 217.12 -- val/X_kl: 9.99 -- val/E_kl: 42.25 -- val/charges_kl: 1.96 
Val loss: 217.1233 	 Best val loss:  208.5513

Sampling start
Sampling a batch with 5 graphs on local rank 0. Saving 5 visualization and 2 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Batch sampled. Visualizing chains starts!
1/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch3/batch5_GR0/molecule_5_0.gif to wandb
2/2 chains saved on local rank 0.Saving /extra/rislek/ConStruct-Thesis/ConStruct/chains/epoch3/batch5_GR0/molecule_6_0.gif to wandb
Visualizing 5 graphs out of 5
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch3_b5/graph_0.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch3_b5/graph_1.png to wandb
Saving /extra/rislek/ConStruct-Thesis/ConStruct/graphs/qm9_debug_ring_count_at_least_2/epoch3_b5/graph_2.png to wandb
Done.
Sampling a batch with 5 graphs on local rank 0. Saving 0 visualization and 0 full chains.
Warning: Adjusted number_chain_steps to 49 to fit within 50 diffusion steps
Done.
Sampled 2 batches on local rank 0. Sampling took 7.89 seconds

Computing sampling metrics on 0...
Error messages: AtomValence 2, Kekulize 0, other 0,  -- No error 8
Some generated smiles: CC1CC2CC2(CN)O1 error CC(N)C1C2CC(C)C21 CC12C34C56C[N+]17C53C6C427 C[C+]1CN(C)C2CNC12 CCCC1(C)CC1 [CH2+]C(O)C1NC1(C)C CC1C2CCC13CC23 error NC[O+]1C[NH2+]1
DEBUG: Calling check_ring_constraints with 10 smiles, type=ring_count_at_least, value=2
DEBUG: Constraint detected! Type: ring_count_at_least, Value: 2
DEBUG: check_ring_constraints called with 10 smiles, type=ring_count_at_least, value=2
[Constraint Check] 5/8 molecules satisfy ring_count_at_least ‚â• 2
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 0] Received SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
Bypassing SIGTERM: 15
[rank: 0] Received SIGTERM: 15
Bypassing SIGTERM: 15
